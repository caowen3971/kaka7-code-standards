# JavaScript编码规范





## 1 代码风格



### 1.1 文件

##### [建议] JavaScript 文件使用无 `BOM` 的 `UTF-8` 编码。



### 1.2 结构

#### 1.2.1 缩进

##### 	[强制] 使用 `4` 个空格做为一个缩进层级，不允许使用 `2` 个空格 或 `tab` 字符。

##### 	[强制] `switch` 下的 `case` 和 `default` 必须增加一个缩进层级。

#### 1.2.2 空格

##### 	[强制] 二元运算符两侧必须有一个空格，一元运算符与操作对象之间不允许有空格。

##### 	[强制] 用作代码块起始的左花括号 `{` 前必须有一个空格。

##### 	[强制] `if / else / for / while / function / switch / do / try / catch / finally` 关键字后，必须有一个空格。

##### 	[强制] 在对象创建时，属性中的 `:` 之后必须有空格，`:` 之前不允许有空格。

##### 	[强制] 函数声明、具名函数表达式、函数调用中，函数名和 `(` 之间不允许有空格。

##### 	[强制] `,` 和 `;` 前不允许有空格。如果不位于行尾，`,` 和 `;` 后必须跟一个空格。

##### 	[强制] 在函数调用、函数声明、括号表达式、属性访问、`if / for / while / switch / catch` 等语句中，`()` 和 `[]` 内紧贴括号部分不允许有空格。

##### 	[强制] 单行声明的数组与对象，如果包含元素，`{}` 和 `[]` 内紧贴括号部分不允许包含空格。

##### 	[强制] 行尾不得有多余的空格。

#### 1.2.3 换行

##### 	[强制] 每个独立语句结束后必须换行。

##### 	[强制] 每行不得超过 `120` 个字符。

##### 	[强制] 运算符处换行时，运算符必须在新行的行首。

##### 	[强制] 在函数声明、函数表达式、函数调用、对象创建、数组创建、`for` 语句等场景中，不允许在 `,` 或 `;` 前换行。

##### 	[建议] 不同行为或逻辑的语句集，使用空行隔开，更易阅读。

##### 	[建议] 在语句的行长度超过 `120` 时，根据逻辑条件合理缩进。

##### 	[建议] 对于 `if...else...`、`try...catch...finally` 等语句，推荐使用在 `}` 号后添加一个换行 的风格，使代码层次结构更清晰，阅读性更好。

#### 1.2.4 语句

##### 	[强制] 不得省略语句结束的分号。

##### 	[强制] 在 `if / else / for / do / while` 语句中，即使只有一行，也不得省略块 `{...}`。

##### 	[强制] 函数定义结束不允许添加分号。

##### [强制] `IIFE` 必须在函数表达式外添加 `(`，非 `IIFE` 不得在函数表达式外添加 `(`。



### 1.3 命名

##### 	[强制] `变量` 使用 `Camel命名法`。

##### 	[强制] `常量` 使用 `全部字母大写，单词间下划线分隔` 的命名方式。

##### 	[强制] `函数` 使用 `Camel命名法`。

##### 	[强制] 函数的 `参数` 使用 `Camel命名法`。

##### 	[强制] `类` 使用 `Pascal命名法`。

##### 	[强制] 类的 `方法` / `属性` 使用 `Camel命名法`。

##### 	[强制] `枚举变量` 使用 `Pascal命名法`，`枚举的属性` 使用 `全部字母大写，单词间下划线分隔` 的命名方式。

##### 	[强制] `命名空间` 使用 `Camel命名法`。

##### 	[强制] 由多个单词组成的缩写词，在命名中，根据当前命名法和出现的位置，所有字母的大小写与首字母的大小写保持一致。

##### 	[强制] `类名` 使用 `名词`。

##### 	[建议] `函数名` 使用 `动宾短语`。

##### 	[建议] `boolean` 类型的变量使用 `is` 或 `has` 开头。

##### 	[建议] `Promise对象` 用 `动宾短语的进行时` 表达。



### 1.4 注释

#### 1.4.1 单行注释

##### 	[强制] 必须独占一行。`//` 后跟一个空格，缩进与下一行被注释说明的代码一致。

#### 1.4.2 多行注释

##### 	[建议] 避免使用 `/*...*/` 这样的多行注释。有多行注释内容时，使用多个单行注释。

#### 1.4.3 文档化注释

##### 	[强制] 为了便于代码阅读和自文档化，以下内容必须包含以 `/**...*/` 形式的块注释中。

##### 	[强制] 文档注释前必须空一行。

##### 	[建议] 自文档化的文档说明 what，而不是 how。

#### 1.4.4 类型定义

##### 	[强制] 类型定义都是以 `{` 开始, 以 `}` 结束。

##### 	[强制] 对于基本类型 {string}, {number}, {boolean}，首字母必须小写。

#### 1.4.5 文件注释

##### 	[强制] 文件顶部必须包含文件注释，用 `@file` 标识文件说明。

##### 	[建议] 文件注释中可以用 `@author` 标识开发者信息。

#### 1.4.6 命名空间注释

##### 	[建议] 命名空间使用 `@namespace` 标识。

#### 1.4.7 类注释

##### 	[建议] 使用 `@class` 标记类或构造函数。

##### 	[建议] 使用 `@extends` 标记类的继承信息。

##### 	[强制] 使用包装方式扩展类成员时， 必须通过 `@lends` 进行重新指向。

##### 	[强制] 类的属性或方法等成员信息不是 `public` 的，应使用 `@protected` 或 `@private` 标识可访问性。

#### 1.4.8 函数/方法注释

##### 	[强制] 函数/方法注释必须包含函数说明，有参数和返回值时必须使用注释标识。

##### 	[强制] 参数和返回值注释必须包含类型信息，且不允许省略参数的说明。

##### 	[建议] 当函数是内部函数，外部不可访问时，可以使用 `@inner` 标识。

##### 	[强制] 对 Object 中各项的描述， 必须使用 `@param` 标识。

##### 	[建议] 重写父类方法时， 应当添加 `@override` 标识。如果重写的形参个数、类型、顺序和返回值类型均未发生变化，可省略 `@param`、`@return`，仅用 `@override` 标识，否则仍应作完整注释。

#### 1.4.9 事件注释

##### 	[强制] 必须使用 `@event` 标识事件，事件参数的标识与方法描述的参数标识相同。

##### 	[强制] 在会广播事件的函数前使用 `@fires` 标识广播的事件，在广播事件代码前使用 `@event` 标识事件。

##### 	[建议] 对于事件对象的注释，使用 `@param` 标识，生成文档时可读性更好。

#### 1.4.10 常量注释

##### 	[强制] 常量必须使用 `@const` 标记，并包含说明和类型信息。

#### 1.4.11 复杂类型注释

##### 	[建议] 对于类型未定义的复杂结构的注释，可以使用 `@typedef` 标识来定义。

#### 1.4.12 细节注释

##### 	[建议] 细节注释遵循单行注释的格式。说明必须换行时，每行是一个单行注释的起始。

##### 	[强制] 有时我们会使用一些特殊标记进行说明。特殊标记必须使用单行注释的形式。下面列举了一些常用标记：

解释：

1. TODO: 有功能待实现。此时需要对将要实现的功能进行简单说明。
2. FIXME: 该处代码运行没问题，但可能由于时间赶或者其他原因，需要修正。此时需要对如何修正进行简单说明。
3. HACK: 为修正某些问题而写的不太好或者使用了某些诡异手段的代码。此时需要对思路或诡异手段进行描述。
4. XXX: 该处存在陷阱。此时需要对陷阱进行描述。



## 2 语言特性

### 2.1 变量

##### 	[强制] 变量、函数在使用前必须先定义。

解释：

不通过 var 定义变量将导致变量污染全局环境。

##### 	[强制] 每个 `var` 只能声明一个变量。

##### 	[强制] 变量必须 `即用即声明`，不得在函数或其它形式的代码块起始位置统一声明所有变量。



### 2.2 条件

##### 	[强制] 在 Equality Expression 中使用类型严格的 `===`。仅当判断 `null` 或 `undefined` 时，允许使用 `== null`。

##### 	[建议] 尽可能使用简洁的表达式。

##### 	[建议] 对于相同变量或表达式的多值条件，用 `switch` 代替 `if`。

##### 	[建议] 如果函数或全局中的 `else` 块后没有任何语句，可以删除 `else`。



### 2.3 循环

##### 	[建议] 不要在循环体中包含函数表达式，事先将函数提取到循环体外。

解释：

循环体中的函数表达式，运行过程中会生成循环次数个函数对象。

##### 	[建议] 对循环内多次使用的不变值，在循环外用变量缓存。



### 2.4 类型

#### 2.4.1 类型检测

##### 	[建议] 类型检测优先使用 `typeof`。对象类型检测使用 `instanceof`。`null` 或 `undefined` 的检测使用 `== null`。

#### 3.4.2 类型转换

##### 	[建议] 转换成 `string` 时，使用 `+ ''`。

##### 	[建议] 转换成 `number` 时，通常使用 `+`。

##### 	[建议] `string` 转换成 `number`，要转换的字符串结尾包含非数字并期望忽略时，使用 `parseInt`。

##### 	[强制] 使用 `parseInt` 时，必须指定进制。

##### 	[建议] 转换成 `boolean` 时，使用 `!!`。

##### 	[建议] `number` 去除小数点，使用 `Math.floor` / `Math.round` / `Math.ceil`，不使用 `parseInt`。



### 2.5 字符串

##### 	[强制] 字符串开头和结束使用单引号 `'`。

##### 	[建议] 使用 `数组` 或 `+` 拼接字符串。



### 2.6 对象

##### 	[强制] 使用对象字面量 `{}` 创建新 `Object`。

##### 	[建议] 对象创建时，如果任何一个 `属性` 需要添加引号，则所有 `属性` 建议添加 `'`。

##### 	[强制] 不允许修改和扩展任何原生对象和宿主对象的原型。

##### 	[建议] 属性访问时，尽量使用 `.`。



### 2.7 数组

##### 	[强制] 使用数组字面量 `[]` 创建新数组，除非想要创建的是指定长度的数组。

##### 	[强制] 遍历数组不使用 `for in`。

##### 	[建议] 清空数组使用 `.length = 0`。





## 3 浏览器环境



### 3.1 模块化

#### 3.1.1 AMD

##### 	[强制] 使用 `AMD` 作为模块定义。

#### 3.1.2 define

##### 	[建议] 定义模块时不要指明 `id` 和 `dependencies`。

##### 	[建议] 使用 `return` 来返回模块定义。

#### 3.1.3 require

##### 	[强制] 全局运行环境中，`require` 必须以 `async require` 形式调用。